FROM tomcat:7-alpine
MAINTAINER knqyf263 <knqyf263@gmail.com>

RUN apk add --no-cache --update vim zip
COPY struts2-showcase-2.3.12.war /tmp

RUN  rm -rf /usr/local/tomcat/webapps/* \
    && cd /tmp \
    && mkdir showcase \
    && unzip struts2-showcase-2.3.12.war -d showcase \
    && sed -i "80i\ \n\t<action name=\"chain\">\n\t\t<result type=\"chain\">date</result>\n\t</action>" /tmp/showcase/WEB-INF/classes/struts.xml \
    && cd showcase \
    && zip -r ROOT.war ./ \
    && mv /tmp/showcase/ROOT.war /usr/local/tomcat/webapps/ \
    && rm -rf /tmp/showcase /tmp/*.war

EXPOSE 8080

